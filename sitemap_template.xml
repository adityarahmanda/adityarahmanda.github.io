<?xml version="1.0" encoding="UTF-8"?>
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">
  {% for post in posts %}
  <url>
    <loc>{{ post.permalink | uriencode }}</loc>
    {% if post.updated %}
    <lastmod>{{ post.updated | formatDate }}</lastmod>
    {% elif post.date %}
    <lastmod>{{ post.date | formatDate }}</lastmod>
    {% endif %}
    <changefreq>monthly</changefreq>
    <priority>0.6</priority>
  </url>
  {% endfor %}

  {% set defaultLang = config.language[0] %}
  {% for lang in config.language %}
    
    {% if lang == defaultLang %}
      {% set prefix = '' %}
    {% else %}
      {% set prefix = '/' + lang %}
    {% endif %}

    {% if lang != 'default' %}
      <url>
        <loc>{{ (config.url + prefix + '/') | uriencode }}</loc>
        <lastmod>{{ sNow | formatDate }}</lastmod>
        <changefreq>daily</changefreq>
        <priority>1.0</priority>
      </url>

      {% for tag in tags %}
      <url>
        <loc>{{ (config.url + prefix + '/' + tag.path) | uriencode }}</loc>
        <lastmod>{{ sNow | formatDate }}</lastmod>
        <changefreq>weekly</changefreq>
        <priority>0.2</priority>
      </url>
      {% endfor %}

      {% for cat in categories %}
      <url>
        <loc>{{ (config.url + prefix + '/' + cat.path) | uriencode }}</loc>
        <lastmod>{{ sNow | formatDate }}</lastmod>
        <changefreq>weekly</changefreq>
        <priority>0.2</priority>
      </url>
      {% endfor %}
    {% endif %}
  {% endfor %}
</urlset>